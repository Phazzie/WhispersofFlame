**Step 3: Spicy Level**- Each player votes on level- System shows vote distribution- Final level = most conservative vote- Chaos mode opt-in- All players must approve to proceed**Step 4: Question Round**- 5-8 questions total- Questions displayed one at a time- Each player answers privately (others can't see until all submit)- Answers revealed simultaneously (prevents anchoring)- Optional: Host can skip questions- Optional: Players can flag inappropriate questions**Step 5: Summary & Insights**- AI-generated summary of session- Highlights shared themes/interests- Suggests "next adventures"- Optional: Dr. Ember's "Therapist Notes" (playful clinical observations)- Optional: Visual memory (abstract art prompt based on session)**Technical Requirements:**- Progress indicator throughout- Ability to pause and resume- Clear visual feedback for "waiting on other players"- Answer character limits: 500 characters- Auto-save of answers (no data loss on connection issues)---### 6. Summary & Insights (The Scribe)**Purpose:** Weave session answers into narrative that highlights connection.**The Scribe's Behavior:****Core Identity:**- Wise, empathetic observer- Friend who points out what others missed- Weaves conversations into narratives- Celebrates vulnerability**Rules:**1. **Focus ONLY on Common Ground**: Summary must highlight what ALL players mentioned2. **Ignore Solo Topics**: One person's unique interest = not included3. **Offer "Next Adventure"**: 1-2 concrete, playful suggestions based on shared interests4. **Speak Directly**: "What became clear is you both..." not "The participants..."5. **Celebrate Vulnerability**: Acknowledge their openness as strength**Summary Structure:**1. Playful opening observation2. Core shared theme identification (specific, not generic)3. Specific question/answer reference4. "Next adventure" suggestions5. Warm, encouraging close**Output:** 3-4 paragraphs, conversational tone---### 7. Therapist Notes (Dr. Ember)**Purpose:** Provide playful clinical observations with personality.**Dr. Ember's Behavior:****Core Identity:**- Relationship therapist with PhD in Intimacy Studies- Clinical language used playfully- Sharp observations with dry wit- Warm but never cloying**Style:**- Uses therapy jargon with a wink: "Patients demonstrated heightened receptivity to sensory-based stimuli"- Identifies patterns, defenses, attachment styles, breakthroughs- Observational, not prescriptive- 3-4 structured paragraphs**Format:**1. **Session Overview**: 1-2 sentences, clinical tone with personality2. **Key Observations**: 3 bullet points about dynamics, patterns, resonance3. **Clinical Impression**: Full paragraph analyzing deeper patterns4. **Recommendations**: Playful suggestions framed as clinical recommendations**Output:** Professional language with delightful personality---### 8. Visual Memories**Purpose:** Transform session emotional themes into tasteful artistic prompts.**Behavior:****Core Identity:**- Visual poet, artistic director- Transforms conversations into art- Creates emotional impressions, not literal representations**Rules:**1. Always abstract and metaphorical (never literal)2. Sophisticated artistic language (art movements, color theory, composition)3. Match emotional temperature of spicy level4. Focus on emotion through visual symbolism5. Keep tasteful always (even Extra-Hot uses sophisticated metaphor)**Style Guide by Spicy Level:**- **Mild**: Watercolors, pastels, soft focus, gentle curves- **Medium**: Oil paintings, warm tones, impressionist, rich textures- **Hot**: Contemporary art, dramatic lighting, bold contrasts, vivid reds- **Extra-Hot**: Abstract expressionism, raw energy, intense colors, primal power**Output:** 50-100 word image prompt suitable for AI image generation**Safety:** Always "safe" or "moderate" - never "explicit"---### 9. Privacy & Security**Purpose:** Ensure user data is protected and intimate conversations remain private.**Core Principles:**1. **Ephemeral by Default**   - Game rooms auto-delete after 24 hours   - No permanent storage of answers   - Session data purged on expiration2. **No Content Moderation on Answers**   - AI never judges or moderates user responses   - No scanning of answer content   - Privacy > content safety for consenting adults3. **Encrypted Transmission**   - All data transmitted via HTTPS   - Room codes generated securely (no predictable patterns)4. **Minimal Data Collection**   - Only required: User account for room creation   - No email requirement for joining   - No analytics on answer content5. **User Control**   - Users can flag inappropriate AI-generated questions   - Ability to skip questions   - Host can end session at any time   - All data deleted on room expiration**Compliance:**- GDPR compliant (data minimization, right to deletion)- COPPA compliant (18+ age gate)- Privacy policy clearly states data handling---## User Experience Requirements### Design Principles1. **Playful, Not Porny**   - Visual design: Warm, inviting, sophisticated   - Color palette: Reds, oranges, warm tones (passion without crudeness)   - Typography: Modern, readable, approachable   - Imagery: Abstract, suggestive, never explicit2. **Safety Through Design**   - Clear visual hierarchy   - Obvious exit points   - Progress indicators   - Confirmation dialogs for sensitive actions3. **Mobile-First**   - Most sessions happen on phones   - Touch-optimized interactions   - Works on smallest screens (320px width)   - Progressive Web App (installable)4. **Accessibility**   - WCAG 2.1 AA compliance   - Screen reader compatible   - Keyboard navigation support   - High contrast mode### Key Screens**1. Home Page**- Hero message: "Your turn to play with fire"- Two primary actions: "Create Room" / "Join Room"- Quick value prop: "AI-guided intimacy conversations for couples"- Social proof: Testimonials (if available)**2. Lobby**- Room code prominently displayed- QR code for easy sharing- Player list with ready status- "Start Game" button (host only)**3. Category Selection**- Grid or list of categories with icons- Each category shows brief description on hover/tap- Selected categories highlighted- "Confirm" button reveals overlap with partner**4. Question Screen**- Question text: Large, centered, easy to read- Answer textarea: Generous size, character count- "Submit" button only active after typing- Waiting state after submit ("Waiting for others...")- Answer reveal: Smooth transition, all answers shown simultaneously**5. Summary Screen**- AI summary text- Optional: Therapist notes in collapsible section- Optional: Visual memory preview- "Play Again" and "Exit" buttons### Copy Voice & Tone**Brand Voice: Ember**- Playful but never crude- Insightful but never clinical- Warm but never patronizing- Specific but never invasive**Tone Examples:**- ✅ "What's one specific way your partner kisses you that makes you forget your own name?"- ❌ "Do you like kissing your partner?"- ✅ "It's clear that for both of you, anticipation is where the magic lives."- ❌ "You both value foreplay."- ✅ "Since you both lit up when talking about control, maybe the next move involves handing it over—or taking it completely."- ❌ "You should try exploring dominance and submission."---## Technical Architecture (Framework-Agnostic)### System Components**1. Client Application**- **Purpose**: User interface, session management- **Requirements**:
  - Web-based (accessible via browser)
  - Responsive (mobile + desktop)
  - Real-time updates (websockets or polling)
  - Progressive Web App (installable)
  - **Framework**: Angular or SvelteKit (Preferred)

**2. API Server**- **Purpose**: Business logic, data orchestration- **Endpoints**:  - `POST /game/create` - Create room  - `POST /game/join` - Join room  - `GET /game/{roomCode}` - Fetch game state  - `POST /game/update` - Update game state  - `DELETE /game/{roomCode}` - Delete room (manual or auto)  - `GET /health` - Health check  - `GET /health/db` - Database health**3. Database**- **Purpose**: Store game state, user accounts- **Requirements**:  - Relational or document-based  - ACID compliance for game state updates  - Auto-expiration of records (TTL)  - Connection pooling  - Row-level locking (prevent race conditions)**Schema (Conceptual):**```Game {  roomCode: string (primary key)  hostId: string  players: array of Player objects  step: enum (lobby, categories, spicy, game, summary)  categories: array of strings  spicyLevel: enum (Mild, Medium, Hot, Extra-Hot)  chaosMode: boolean  questions: array of strings  answers: array of strings  summary: string (nullable)  createdAt: timestamp  expiresAt: timestamp (createdAt + 24 hours)}User {  id: string (primary key)  email: string  createdAt: timestamp}```**4. AI Service**- **Purpose**: Generate questions, summaries, therapist notes, visual prompts- **Behavioral Contract**: Must strictly implement the persona and patterns defined in `aiguidence.md`.- **Requirements**:  - LLM integration (Grok-4-fast-reasoning)  - Prompt management system  - Input sanitization (prevent prompt injection)  - Timeout handling (fallback to preset questions)  - Rate limiting  - Retry logic with exponential backoff**Flows:**- `generateQuestion(categories, spicyLevel, previousQuestions)` → string- `generateSummary(questions, answers, categories, spicyLevel)` → string- `generateTherapistNotes(questions, answers, categories, spicyLevel)` → string- `generateVisualMemory(summary, spicyLevel, sharedThemes)` → {imagePrompt, safetyLevel}**5. Authentication Service**- **Purpose**: User account management, session protection- **Requirements**:  - OAuth providers (Google, Apple, Email)  - Session management  - JWT or session tokens  - Password reset flows  - Email verification**6. Background Jobs**- **Purpose**: Automated cleanup, maintenance- **Jobs**:  - Expire old game rooms (runs hourly)  - Database cleanup (runs daily)  - Health checks (runs every 5 minutes)

---

## SDD Architecture Strategy (Seam-Driven Development)

To ensure rapid, parallel development and high reliability, this project will strictly follow Seam-Driven Development (SDD) principles as defined below.

### 1. The SDD Process Flow

1.  **Input**: PRD / App Idea.
2.  **Seam Identification**: Define boundaries where data passes (Boundary, Transformation, Coordination, Presentation).
3.  **Contract Definition**: Write TypeScript Interfaces with **extensive top-level comments** explaining What, Why, and How data flows.
4.  **Test Generation**: Write tests against the Contract (not the implementation).
5.  **Mocking**: Implement Mocks to make tests pass.
6.  **Implementation**: Implement Real Services.
7.  **Verification**: Ensure Contract Compliance Rate (CCR) = 1.0 (Mock and Real pass exactly the same tests).
    *   *Optional*: UI development can start after Step 2.

### 2. Key Tenets

*   **Regeneration over Debugging**: If a component takes more than 2 attempts to debug, delete and regenerate it from the contract.
*   **Binary Mocking**: Mock everything or mock nothing. (We choose: **Mock Everything**).
*   **One Thing at a Time**: Focus on completing one seam fully before moving to the next.
*   **Automation > Discipline**: Build tools to enforce rules rather than relying on human memory.
*   **Quality > Speed**: SDD compliance and zero technical debt are higher priorities than raw development speed.
*   **Documentation**: Every file must have extensive top-level comments describing:
    *   **What** the file does.
    *   **Why** it exists.
    *   **How** information flows through it.
*   **Continuous Innovation**: This project will attempt a new framework or tooling approach to expand the methodology (Candidate: Flutter/Dart or Effect-TS).

### 3. Seam Categorization

**Category 1: Boundary Seams (Trust Nothing)**
- **User Input Boundary**: Validates all incoming answers, room codes, and category selections.
- **AI Service Boundary**: Manages communication with Grok-4-fast-reasoning.

**Category 2: Transformation Seams (Pure Logic)**
- **Ember Engine**: The core logic for selecting question patterns based on `aiguidence.md`.
- **The Scribe Engine**: Logic for summarizing sessions.

**Category 3: Coordination Seams (Shared State)**
- **Game Room Manager**: Manages the lifecycle of a game room.
- **Session Store**: Ephemeral storage for active game states.

**Category 4: Presentation Seams (UI/UX)**
- **Game Client**: Frontend implementation.

### 4. Project Artifacts
- **Contract Template**: A standardized template for all interfaces.
- **Changelog & Lessons Learned**: A living document tracking architectural decisions and SDD evolutions.

---

### Data Flow**Creating a Game:**```1. User authenticates2. Client → API: POST /game/create {roomCode, playerName}3. API → Database: Create game record4. API → Client: Return game state5. Client displays lobby + room code```**Joining a Game:**```1. User (with or without account) enters room code2. Client → API: POST /game/join {roomCode, playerName}3. API → Database: Add player to game4. API → Client: Return updated game state5. Client displays lobby6. All connected clients receive state update via polling/websockets```**Playing a Round:**```1. Host advances to "game" step2. Client → AI Service: Generate question3. AI Service → Client: Return question4. All players see question5. Each player submits answer6. Client → API: POST /game/update {roomCode, updates: {answers: [...]}}7. API → Database: Update game state8. When all answers submitted, reveal to all players9. Repeat for 5-8 questions```**Generating Summary:**```1. Host advances to "summary" step2. Client → AI Service: Generate summary3. AI Service analyzes all Q&A pairs4. AI Service → Client: Return summary5. Client → API: POST /game/update {summary}6. All players see summary```---### Non-Functional Requirements**Performance:**- Page load time: < 2 seconds (initial)- AI response time: < 5 seconds (question generation)- AI response time: < 10 seconds (summary generation)- State synchronization latency: < 2 seconds- Support 100 concurrent game sessions**Scalability:**- Horizontally scalable API servers- Database connection pooling- CDN for static assets- AI service rate limiting**Reliability:**- 99.5% uptime target- Auto-retry for transient failures- Graceful degradation (fallback questions if AI fails)- Database backups (daily)- Disaster recovery plan**Security:**- HTTPS only- SQL injection prevention (parameterized queries)- XSS prevention (HTML sanitization)- CSRF protection- Rate limiting (prevent abuse)- Input validation (Zod or similar schema validation)---## Success Criteria### Launch Criteria (MVP)**Must Have:**- ✅ User authentication- ✅ Game room creation and joining- ✅ Category selection with overlap detection- ✅ Spicy level calibration- ✅ AI question generation (at least 3 patterns implemented)- ✅ Q&A round (5 questions minimum)- ✅ Session summary generation- ✅ Mobile-responsive design- ✅ 24-hour auto-expiration- ✅ Privacy policy**Should Have:**- Therapist notes feature- Chaos mode- Visual memory generation- QR code sharing- Answer character limits with validation**Could Have:**- Session history (non-persisted answers, just metadata)- Achievement system- Customizable question count- Multi-language support### Post-Launch Success Metrics (6 Months)**Engagement:**- 500+ game sessions created- 70%+ session completion rate- 2.5+ sessions per user (lifetime average)**Quality:**- 4.0+ average rating (if we add rating system)- < 5% premature exit rate- < 1% flagged questions rate**Growth:**- 20% month-over-month user growth- 30%+ viral coefficient (1 user invites 1.3 others)- 10%+ organic social sharing rate---## Risks & Mitigations### Risk 1: AI Generates Inappropriate Questions**Impact:** High (damages user trust, brand reputation)**Mitigation:**- Extensive prompt engineering with safety guidelines- Question flagging system- Human review of flagged questions- Fallback to curated question bank if AI fails- Continuous monitoring and improvement### Risk 2: Privacy Breach**Impact:** Critical (user data exposed, legal consequences)**Mitigation:**- Minimal data collection- Encryption in transit and at rest- Regular security audits- Penetration testing before launch- Incident response plan- Auto-deletion of expired sessions- No logging of answer content### Risk 3: Low Engagement/Completion Rates**Impact:** Medium (product-market fit question)**Mitigation:**- User testing before launch- Progressive disclosure (don't overwhelm with options)- Clear onboarding flow- Engaging copy and design- Save/resume functionality- Post-session surveys to understand drop-off### Risk 4: AI Service Downtime or Rate Limits**Impact:** Medium (degraded experience)**Mitigation:**- Fallback question bank (100+ curated questions)- Retry logic with exponential backoff- Multiple AI provider support- Clear error messaging to users- Graceful degradation### Risk 5: Misuse (Harassment, Non-Consensual Use)**Impact:** High (user safety, legal)**Mitigation:**- Terms of Service explicitly prohibit misuse- Age gate (18+)- Question flagging system- Ability to exit session immediately- Report abuse mechanism- Ban policy for violations---## Future Enhancements (Post-MVP)### Phase 2 Features1. **Session History (Metadata Only)**   - Track number of sessions played   - Categories explored   - Spicy levels used   - NO storage of actual answers (privacy-first)2. **Achievement System**   - Unlock achievements based on exploration   - Examples: "First Timer," "Chaos Enthusiast," "Category Explorer"   - Playful, encouraging tone3. **Customization Options**   - Custom question count (3-10)   - Custom timer per question   - Voice/tone preferences for Ember4. **Social Features (Opt-In)**   - Shareable session badges (no content, just "We explored Power Play at Hot level")   - Referral system   - Anonymous community insights ("80% of couples enjoyed this category")### Phase 3 Features1. **Premium Tier**   - Advanced AI personas (different voices for Ember)   - Longer sessions (15+ questions)   - Deeper insights and analysis   - Session history with encrypted answer storage   - Priority AI processing2. **Couples Challenges**   - Weekly themed challenges   - Seasonal question packs   - Anniversary mode3. **Integration with Physical Products**   - Game card deck companion   - Branded merchandise   - Partner apps (bedroom tech integration)---## Open Questions1. **Monetization Strategy**   - Free tier limitations?   - Pricing for premium?   - Subscription vs. pay-per-session?2. **Content Moderation**   - How much human review of flagged questions?   - What's the threshold for banning users?3. **Expansion Beyond Couples**   - Solo mode for self-reflection?   - Support for 4+ person groups?   - Different relationship structures (open relationships, long-distance)?4. **Regulatory Compliance**   - Age verification requirements by jurisdiction?   - Adult content regulations in different countries?5. **Data Retention**   - User requests to keep session data longer?   - Export functionality for personal archiving?---## Appendix### Glossary- **Ember**: The AI persona that generates questions and insights- **The Scribe**: The AI persona that writes session summaries- **Dr. Ember**: The AI persona that writes therapist notes- **Room Code**: 6-character alphanumeric code for joining games- **Spicy Level**: Intensity calibration (Mild, Medium, Hot, Extra-Hot)- **Chaos Mode**: Random spicy level upgrades during session- **Next Adventure**: Concrete suggestions for continued exploration### References- aiguidence.md: Core Ember personality and question patterns- agents.md: Detailed AI persona documentation- aiprompting.md: Full prompt engineering guidelines---**End of Document**